var AudioMetadata=function(p){"use strict";const b=e=>e.replace(/\0+$/,""),E=(e,t)=>{const n=e.indexOf(t);return[e.substring(0,n),e.substring(n+1)]},d=e=>{if(e instanceof Uint8Array&&(e=e.buffer.slice(0)),!(e instanceof ArrayBuffer))throw new Error("Expected instance of Buffer or ArrayBuffer");return new DataView(e)},h=(e,t,n)=>new Uint8Array(e.buffer).slice(t,t+n),y=e=>(t,n,r)=>new TextDecoder(e).decode(t.buffer.slice(n,n+r)),u=y("ascii"),A=y(),B=y("utf-16be"),m=y("utf-16le"),S=(e,t)=>{if(e.byteLength<t+27)return;const n=e.getUint8(t+26),r=h(e,t+27,n),a=27+n;if(!r.length)return;const c=a+r.reduce((o,i)=>o+i),s=a+7;return{pageSize:c,packet:d(h(e,t+s,c-s))}},D=e=>{try{const t=e.getUint32(0,!0),n=e.getUint32(4+t,!0),r={},a={tracknumber:"track"};for(let c=0,s=8+t;c<n;c++){const o=e.getUint32(s,!0),i=A(e,s+4,o),[g,l]=E(i,"="),U=g.toLowerCase();r[a[U]||U]=r[U]=b(l),s+=4+o}return r}catch{return}},z=e=>{const t=d(e),n=S(t,0);if(!n)return;const r=S(t,n.pageSize);if(r)return D(r.packet)},M=e=>u(e,e.byteLength-128,3)==="TAG",j=e=>{const t=d(e);try{if(!M(t))return;const n=t.byteLength-128,r=t.getUint8(n+125)===0,a=b(u(t,n+3,30)),c=b(u(t,n+33,30)),s=b(u(t,n+63,30)),o=b(u(t,n+93,4)),i=b(u(t,n+97,r?28:30)),g=r?t.getUint8(n+126):void 0,l=t.getUint8(n+127);return{title:a,artist:c,album:s,year:o,comment:i,track:g,genre:l}}catch{return}},C=(e,t)=>h(e,t,4).reduce((n,r)=>n<<7|r&268435455,0),F=e=>{switch(e){case 1:return(t,n,r)=>t.getUint16(n)===65279?B(t,n,r):y("utf16le")(t,n,r);case 2:return y("utf16be");case 3:return A;case 0:default:return u}},$={TALB:"album",TCOM:"composer",TIT1:"title",TIT2:"title",TPE1:"artist",TRCK:"track",TSSE:"encoder",TDRC:"year",TCON:"genre"},I=(e,t)=>{try{const n=u(e,t,4),r=10+C(e,t+4),a=n[0]==="T"?b(F(e.getUint8(t+9))(e,t+11,r-11)):void 0;return{id:n,size:r,content:a}}catch{return}},H=e=>{const t=d(e);if(u(t,0,3)!=="ID3")return;const n=t.getUint8(5),r=C(t,6),a=!!(n&128),c={},s=a?C(t,10):0;for(let o=10+s;o<10+s+r;){const i=I(t,o);if(!i)break;if(o+=i.size,!i.content)continue;const g=$[i.id]||i.id;if(g==="TXXX"){const[l,U]=E(i.content,"\0");c[l]=U}else c[g]=c[i.id]=i.content}return c},N=e=>u(e,0,4)==="fLaC",P=e=>{const t=d(e);if(!N(t))return;let n=4,r=!1,a={};for(;!r;){const c=t.getUint8(n),s=t.getUint16(n+1)*2**16+t.getUint8(n+3);r=c>127,(c&127)==4&&(a=Object.assign(a,D(d(h(t,n+4,s))))),n+=4+s}return a},L=(e,t)=>{let n="";for(let r=0;r<2;r++)n+=e.getBigUint64(t+r*8).toString(16).padStart(16,"0").toUpperCase();return n},X=(e,t)=>{const n=e.getUint16(t,!0),r=e.getUint16(t+2,!0),a=e.getUint16(t+4,!0),c=e.getUint16(t+6,!0),s=e.getUint16(t+8,!0);return{title:m(e,t+=10,n).replace(/\0$/,""),artist:m(e,t+=n,r).replace(/\0$/,""),copyright:m(e,t+=r,a).replace(/\0$/,""),comment:m(e,t+=a,c).replace(/\0$/,""),rating:m(e,t+=c,s).replace(/\0$/,"")}},O={"wm/albumtitle":"album"},K=(e,t)=>{const n={},r=e.getUint16(t,!0);t+=2;for(let a=0;a<r;a++){const c=e.getUint16(t,!0),s=m(e,t+=2,c).replace(/\0$/,"").toLowerCase(),o=s.startsWith("wm/")?s.slice(3):s,i=O[s]||s,g=e.getUint16(t+=c,!0),l=e.getUint16(t+=2,!0);switch(g){case 0:n[o]=n[i]=m(e,t+=2,l).replace(/\0$/,"");break}t+=l}return n},R=(e,t)=>{const n=e.getUint32(t+18),r={};for(t+=22;t<n;){switch(L(e,t)){case"EACBF8C5AF5B48778467AA8C44FA4CCA":case"941C23449894D149A1411D134E457054":Object.assign(r,V(e,t+24));break}t+=Number(e.getBigUint64(t+16,!0))}return r},V=(e,t)=>{const n={},r=e.getUint16(t,!0);t+=2;for(let a=0;a<r;a++){t+=4;const c=e.getUint16(t,!0),s=e.getUint16(t+=2,!0),o=e.getUint16(t+=2,!0),i=m(e,t+=2,c).replace(/\0$/,"").toLowerCase(),g=i.startsWith("wm/")?i.slice(3):i,l=O[i]||i;switch(s){case 0:n[g]=n[l]=m(e,t+=c,o).replace(/\0$/,"");break}t+=o}return n},W=e=>{const t=d(e);if(L(t,0)==="3026B2758E66CF11A6D900AA0062CE6C")try{const n=t.getBigUint64(16,!0),r={};let a=30;for(;a<n;){switch(L(t,a)){case"3326B2758E66CF11A6D900AA0062CE6C":Object.assign(r,X(t,a+24));break;case"40A4D0D207E3D21197F000A0C95EA850":Object.assign(r,K(t,a+24));break;case"B503BF5F2EA9CF118EE300C00C205365":Object.assign(r,R(t,a+24));break;default:}a+=Number(t.getBigUint64(a+16,!0))}return r}catch{return}},_=(e,t)=>{try{const n=e.getUint32(t),r=n===1?Number(e.getBigUint64(t+8)):n||e.byteLength-t,a=n===1?16:8;return{size:r,type:u(e,t+4,4).toLowerCase(),data:d(h(e,t+a,r-a))}}catch{return}},k=function*(e){var a;let t,n=0,r=0;for(;(t=_(e,n+=(a=t==null?void 0:t.size)!=null?a:0))&&!(r++>100);)yield t},G={"\xA9alb":"album","\xA9wrt":"composer","\xA9nam":"title","\xA9art":"artist",aart:"albumartist","\xA9cmt":"comment",trkn:"track","\xA9too":"encoder","\xA9day":"year","\xA9gen":"genre",gnre:"genre"},x=e=>{const t=[...k(e)].find(n=>n.type==="data");if(t)switch(t.data.getUint32(0)){case 1:case 4:return A(t.data,8,t.data.byteLength-8);case 2:case 5:return B(t.data,8,t.data.byteLength-8)}},q=e=>{const t={};for(const n of k(e))Object.assign(t,{[n.type]:x(n.data),[G[n.type]||n.type]:x(n.data)});return t},T=e=>{const t={};for(const n of k(e))switch(n.type){case"moov":case"trak":case"mdia":case"udta":Object.assign(t,T(n.data));break;case"meta":Object.assign(t,T(J(n.data)));break;case"ilst":Object.assign(t,q(n.data));break}return t},J=e=>{const t=u(e,4,4),n=u(e,16,4);return t==="hdlr"&&n==="mdta"?e:d(h(e,4,e.byteLength-4))},Q=e=>{const t=d(e),n=T(t);return Object.keys(n).length===0?void 0:n};return p.flac=P,p.id3v1=j,p.id3v2=H,p.mp4=Q,p.ogg=z,p.wma=W,Object.defineProperties(p,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}}),p}({});
