var AudioMetadata=function(m){"use strict";const U=e=>e.replace(/\0+$/,""),L=(e,t)=>{const n=e.indexOf(t);return[e.substring(0,n),e.substring(n+1)]},p=e=>{if(e instanceof Uint8Array&&(e=e.buffer.slice(0)),!(e instanceof ArrayBuffer))throw new Error("Expected instance of Buffer or ArrayBuffer");return new DataView(e)},C=(e,t,n)=>new Uint8Array(e.buffer).slice(t,t+n),h=e=>(t,n,r)=>new TextDecoder(e).decode(t.buffer.slice(n,n+r)),u=h("ascii"),T=h(),D=h("utf-16be"),l=h("utf-16le"),E=(e,t)=>{if(e.byteLength<t+27)return;const n=e.getUint8(t+26),r=C(e,t+27,n),c=27+n;if(!r.length)return;const a=c+r.reduce((o,s)=>o+s),i=c+7;return{pageSize:a,packet:p(C(e,t+i,a-i))}},k=e=>{try{const t=e.getUint32(0,!0),n=e.getUint32(4+t,!0),r={},c={tracknumber:"track"};for(let a=0,i=8+t;a<n;a++){const o=e.getUint32(i,!0),s=T(e,i+4,o),[g,d]=L(s,"="),b=g.toLowerCase();r[c[b]||b]=r[b]=U(d),i+=4+o}return r}catch{return}},S=e=>{const t=p(e),n=E(t,0);if(!n)return;const r=E(t,n.pageSize);if(r)return k(r.packet)},F=e=>u(e,e.byteLength-128,3)==="TAG",M=e=>{const t=p(e);try{if(!F(t))return;const n=t.byteLength-128,r=t.getUint8(n+125)===0,c=U(u(t,n+3,30)),a=U(u(t,n+33,30)),i=U(u(t,n+63,30)),o=U(u(t,n+93,4)),s=U(u(t,n+97,r?28:30)),g=r?t.getUint8(n+126):void 0,d=t.getUint8(n+127);return{title:c,artist:a,album:i,year:o,comment:s,track:g,genre:d}}catch{return}},A=(e,t)=>C(e,t,4).reduce((n,r)=>n<<7|r&268435455,0),$=e=>{switch(e){case 1:return(t,n,r)=>t.getUint16(n)===65279?D(t,n,r):h("utf16le")(t,n,r);case 2:return h("utf16be");case 3:return T;case 0:default:return u}},O={TALB:"album",TCOM:"composer",TIT1:"title",TIT2:"title",TPE1:"artist",TRCK:"track",TSSE:"encoder",TDRC:"year",TCON:"genre"},z=(e,t)=>{try{const n=u(e,t,4),r=10+A(e,t+4),c=n[0]==="T"?U($(e.getUint8(t+9))(e,t+11,r-11)):void 0;return{id:n,size:r,content:c}}catch{return}},j=e=>{const t=p(e);if(u(t,0,3)!=="ID3")return;const n=t.getUint8(5),r=A(t,6),c=!!(n&128),a={},i=c?A(t,10):0;for(let o=10+i;o<10+i+r;){const s=z(t,o);if(!s)break;if(o+=s.size,!s.content)continue;const g=O[s.id]||s.id;if(g==="TXXX"){const[d,b]=L(s.content,"\0");a[d]=b}else a[g]=a[s.id]=s.content}return a},H=e=>u(e,0,4)==="fLaC",I=e=>{const t=p(e);if(!H(t))return;let n=4,r=!1,c={};for(;!r;){const a=t.getUint8(n),i=t.getUint16(n+1)*2**16+t.getUint8(n+3);r=a>127,(a&127)==4&&(c=Object.assign(c,k(p(C(t,n+4,i))))),n+=4+i}return c},y=(e,t)=>{let n="";for(let r=0;r<2;r++)n+=e.getBigUint64(t+r*8).toString(16).padStart(16,"0").toUpperCase();return n},x=(e,t)=>{const n=e.getUint16(t,!0),r=e.getUint16(t+2,!0),c=e.getUint16(t+4,!0),a=e.getUint16(t+6,!0),i=e.getUint16(t+8,!0);return{title:l(e,t+=10,n).replace(/\0$/,""),artist:l(e,t+=n,r).replace(/\0$/,""),copyright:l(e,t+=r,c).replace(/\0$/,""),comment:l(e,t+=c,a).replace(/\0$/,""),rating:l(e,t+=a,i).replace(/\0$/,"")}},B={"wm/albumtitle":"album"},N=(e,t)=>{const n={},r=e.getUint16(t,!0);t+=2;for(let c=0;c<r;c++){const a=e.getUint16(t,!0),i=l(e,t+=2,a).replace(/\0$/,"").toLowerCase(),o=i.startsWith("wm/")?i.slice(3):i,s=B[i]||i,g=e.getUint16(t+=a,!0),d=e.getUint16(t+=2,!0);switch(g){case 0:n[o]=n[s]=l(e,t+=2,d).replace(/\0$/,"");break}t+=d}return n},P=(e,t)=>{const n=e.getUint32(t+18),r={};for(t+=22;t<n;){switch(y(e,t)){case"EACBF8C5AF5B48778467AA8C44FA4CCA":case"941C23449894D149A1411D134E457054":Object.assign(r,X(e,t+24));break}t+=Number(e.getBigUint64(t+16,!0))}return r},X=(e,t)=>{const n={},r=e.getUint16(t,!0);t+=2;for(let c=0;c<r;c++){t+=4;const a=e.getUint16(t,!0),i=e.getUint16(t+=2,!0),o=e.getUint16(t+=2,!0),s=l(e,t+=2,a).replace(/\0$/,"").toLowerCase(),g=s.startsWith("wm/")?s.slice(3):s,d=B[s]||s;switch(i){case 0:n[g]=n[d]=l(e,t+=a,o).replace(/\0$/,"");break}t+=o}return n},v=e=>{const t=p(e);if(y(t,0)==="3026B2758E66CF11A6D900AA0062CE6C")try{const n=t.getBigUint64(16,!0),r={};let c=30;for(;c<n;){switch(y(t,c)){case"3326B2758E66CF11A6D900AA0062CE6C":Object.assign(r,x(t,c+24));break;case"40A4D0D207E3D21197F000A0C95EA850":Object.assign(r,N(t,c+24));break;case"B503BF5F2EA9CF118EE300C00C205365":Object.assign(r,P(t,c+24));break;default:}c+=Number(t.getBigUint64(c+16,!0))}return r}catch{return}};return m.flac=I,m.id3v1=M,m.id3v2=j,m.ogg=S,m.wma=v,Object.defineProperties(m,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}}),m}({});
