(function(g,o){typeof exports=="object"&&typeof module<"u"?o(exports):typeof define=="function"&&define.amd?define(["exports"],o):(g=typeof globalThis<"u"?globalThis:g||self,o(g.AudioMetadata={}))})(this,function(g){"use strict";const o=t=>t.replace(/\0+$/,""),U=(t,e)=>{const n=t.indexOf(e);return[t.substring(0,n),t.substring(n+1)]},h=t=>{if(t instanceof Uint8Array&&(t=t.buffer.slice(0)),!(t instanceof ArrayBuffer))throw new Error("Expected instance of Buffer or ArrayBuffer");return new DataView(t)},y=(t,e,n)=>new Uint8Array(t.buffer).slice(e,e+n),f=t=>(e,n,r)=>new TextDecoder(t).decode(e.buffer.slice(n,n+r)),u=f("ascii"),p=f(),L=f("utf16be"),v=(t,e)=>{if(t.byteLength<e+27)return;const n=t.getUint8(e+26),r=y(t,e+27,n),a=27+n;if(!r.length)return;const c=a+r.reduce((d,i)=>d+i),s=a+7;return{pageSize:c,packet:h(y(t,e+s,c-s))}},S=t=>{try{const e=t.getUint32(0,!0),n=t.getUint32(4+e,!0),r={},a={tracknumber:"track"};for(let c=0,s=8+e;c<n;c++){const d=t.getUint32(s,!0),i=p(t,s+4,d),[l,m]=U(i,"="),T=l.toLowerCase();r[a[T]||T]=r[T]=o(m),s+=4+d}return r}catch{return}},k=t=>{const e=h(t),n=v(e,0);if(!n)return;const r=v(e,n.pageSize);if(r)return S(r.packet)},A=t=>u(t,t.byteLength-128,3)==="TAG",M=t=>{const e=h(t);try{if(!A(e))return;const n=e.byteLength-128,r=e.getUint8(n+125)===0,a=o(u(e,n+3,30)),c=o(u(e,n+33,30)),s=o(u(e,n+63,30)),d=o(u(e,n+93,4)),i=o(u(e,n+97,r?28:30)),l=r?e.getUint8(n+126):void 0,m=e.getUint8(n+127);return{title:a,artist:c,album:s,year:d,comment:i,track:l,genre:m}}catch{return}},b=(t,e)=>y(t,e,4).reduce((n,r)=>n<<7|r&268435455,0),x=t=>{switch(t){case 1:return(e,n,r)=>e.getUint16(n)===65279?L(e,n,r):f("utf16le")(e,n,r);case 2:return f("utf16be");case 3:return p;case 0:default:return u}},z={TALB:"album",TCOM:"composer",TIT1:"title",TIT2:"title",TPE1:"artist",TRCK:"track",TSSE:"encoder",TDRC:"year",TCON:"genre"},C=(t,e)=>{try{const n=u(t,e,4),r=10+b(t,e+4),a=n[0]==="T"?o(x(t.getUint8(e+9))(t,e+11,r-11)):void 0;return{id:n,size:r,content:a}}catch{return}},w=t=>{const e=h(t);if(u(e,0,3)!=="ID3")return;const n=e.getUint8(5),r=b(e,6),a=!!(n&128),c={},s=a?b(e,10):0;for(let d=10+s;d<10+s+r;){const i=C(e,d);if(!i)break;if(d+=i.size,!i.content)continue;const l=z[i.id]||i.id;if(l==="TXXX"){const[m,T]=U(i.content,"\0");c[m]=T}else c[l]=c[i.id]=i.content}return c};g.id3v1=M,g.id3v2=w,g.ogg=k,Object.defineProperties(g,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
