"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const d=t=>t.replace(/\0+$/,""),b=(t,e)=>{const n=t.indexOf(e);return[t.substring(0,n),t.substring(n+1)]},f=t=>{if(t instanceof Uint8Array&&(t=t.buffer.slice(0)),!(t instanceof ArrayBuffer))throw new Error("Expected instance of Buffer or ArrayBuffer");return new DataView(t)},y=(t,e,n)=>new Uint8Array(t.buffer).slice(e,e+n),T=t=>(e,n,r)=>new TextDecoder(t).decode(e.buffer.slice(n,n+r)),u=T("ascii"),v=T(),p=T("utf16be"),U=(t,e)=>{if(t.byteLength<e+27)return;const n=t.getUint8(e+26),r=y(t,e+27,n),s=27+n;if(!r.length)return;const i=s+r.reduce((a,c)=>a+c),o=s+7;return{pageSize:i,packet:f(y(t,e+o,i-o))}},L=t=>{try{const e=t.getUint32(0,!0),n=t.getUint32(4+e,!0),r={},s={tracknumber:"track"};for(let i=0,o=8+e;i<n;i++){const a=t.getUint32(o,!0),c=v(t,o+4,a),[g,l]=b(c,"="),m=g.toLowerCase();r[s[m]||m]=r[m]=d(l),o+=4+a}return r}catch{return}},S=t=>{const e=f(t),n=U(e,0);if(!n)return;const r=U(e,n.pageSize);if(r)return L(r.packet)},k=t=>u(t,t.byteLength-128,3)==="TAG",x=t=>{const e=f(t);try{if(!k(e))return;const n=e.byteLength-128,r=e.getUint8(n+125)===0,s=d(u(e,n+3,30)),i=d(u(e,n+33,30)),o=d(u(e,n+63,30)),a=d(u(e,n+93,4)),c=d(u(e,n+97,r?28:30)),g=r?e.getUint8(n+126):void 0,l=e.getUint8(n+127);return{title:s,artist:i,album:o,year:a,comment:c,track:g,genre:l}}catch{return}},h=(t,e)=>y(t,e,4).reduce((n,r)=>n<<7|r&268435455,0),A=t=>{switch(t){case 1:return(e,n,r)=>e.getUint16(n)===65279?p(e,n,r):T("utf16le")(e,n,r);case 2:return T("utf16be");case 3:return v;case 0:default:return u}},M={TALB:"album",TCOM:"composer",TIT1:"title",TIT2:"title",TPE1:"artist",TRCK:"track",TSSE:"encoder",TDRC:"year",TCON:"genre"},z=(t,e)=>{try{const n=u(t,e,4),r=10+h(t,e+4),s=n[0]==="T"?d(A(t.getUint8(e+9))(t,e+11,r-11)):void 0;return{id:n,size:r,content:s}}catch{return}},C=t=>{const e=f(t);if(u(e,0,3)!=="ID3")return;const n=e.getUint8(5),r=h(e,6),s=!!(n&128),i={},o=s?h(e,10):0;for(let a=10+o;a<10+o+r;){const c=z(e,a);if(!c)break;if(a+=c.size,!c.content)continue;const g=M[c.id]||c.id;if(g==="TXXX"){const[l,m]=b(c.content,"\0");i[l]=m}else i[g]=i[c.id]=c.content}return i};exports.id3v1=x;exports.id3v2=C;exports.ogg=S;
