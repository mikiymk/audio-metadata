"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const y=t=>{let e;if(ArrayBuffer.isView(t))e=new DataView(t.buffer,t.byteOffset,t.byteLength);else if(t instanceof ArrayBuffer||t instanceof SharedArrayBuffer)e=new DataView(t);else throw new Error("Expected instance of TypedArray, DataView or ArrayBuffer");return{view:e,position:0}},u=(t,e)=>{const n=t.position,o=t.view;return t.position+=e,{view:o,position:n}},V=(t,e)=>{const n=t.position,o=t.view;return t.position=e<0?o.byteLength+e:e,{view:o,position:n}},S=t=>t.view.byteLength-t.position,s=(t,e,n=!1)=>{const{view:o,position:r}=u(t,e);return Number(o[{1:"getUint8",2:"getUint16",4:"getUint32",8:"getBigUint64"}[e]](r,n))},k=(t,e)=>{const{view:n,position:o}=u(t,e);return n.buffer.slice(o,o+e)},m="ascii",C="utf-8",L="utf-16be",p="utf-16le",a=(t,e,n=C)=>new TextDecoder(n).decode(k(t,e)),B=(t,e)=>new Uint8Array(k(t,e)),b=(t,e)=>y(k(t,e)),T=(t,e=0)=>(...n)=>{const[{view:o,position:r},...c]=n;return t({view:o,position:r+e},...c)},d=t=>t.replace(/\0+$/,""),G=(t,e)=>{const n=t.indexOf(e);return[t.substring(0,n),t.substring(n+1)]},z=t=>{if(S(t)<27)return;const e=(u(t,26),s(t,1)),n=B(t,e);if(!n.length)return;const o=n.reduce((r,c)=>r+c);return u(t,7),{pageSize:o+27+e,packet:b(t,o-7)}},M=t=>{try{const e=s(t,4,!0),n=(u(t,e),s(t,4,!0)),o={},r={tracknumber:"track"};for(let c=0;c<n;c++){const l=s(t,4,!0),i=a(t,l),[f,g]=G(i,"="),h=f.toLowerCase();o[r[h]||h]=o[h]=d(g)}return o}catch{return}},v=t=>{const e=y(t);if(!z(e))return;const o=z(e);if(o)return M(o.packet)},H=t=>(V(t,-128),a(t,3,m)==="TAG"),O=t=>{const e=y(t);try{if(!H(e))return;const n=T(s,122)(e,1)===0;return{title:d(a(e,30,m)),artist:d(a(e,30,m)),album:d(a(e,30,m)),year:d(a(e,4,m)),comment:d(a(e,n?28:30,m)),track:n?s(e,2):void 0,genre:s(e,1)}}catch{return}},x=t=>B(t,4).reduce((e,n)=>e<<7|n&127,0),R=(t,e)=>{var n;return a(t,e-1,(n={0:m,1:T(s)(t,2)===65279?L:p,2:L}[s(t,1)])!=null?n:C)},j={TALB:"album",TCOM:"composer",TIT1:"title",TIT2:"title",TPE1:"artist",TRCK:"track",TSSE:"encoder",TDRC:"year",TCON:"genre"},N=t=>{try{const e=a(t,4,m),n=x(t);u(t,2);const o=e[0]==="T"?d(R(t,n)):(u(t,n),void 0);return{id:e,content:o}}catch{return}},X=t=>{const e=y(t);if(a(e,3,m)!=="ID3")return;const n=(u(e,2),s(e,1)),o=x(e),r=!!(n&128),c={},l=r?x(e):0;for(u(e,l);e.position<10+l+o;){const i=N(e);if(!i)break;if(!i.content)continue;const f=j[i.id]||i.id;if(f==="TXXX"){const[g,h]=G(i.content,"\0");c[g]=h}else c[f]=c[i.id]=i.content}return c},K=t=>{const e=y(t);if(a(e,4,m)!=="fLaC")return;let n=!1,o={};for(;!n;){const r=s(e,1),c=s(e,2)*2**8+s(e,1);n=r>127,(r&127)==4?o={...o,...M(b(e,c))}:u(e,c)}return o},W=t=>"G"+B(t,16).reduce((e,n)=>e+n.toString(16).padStart(2,"0").toUpperCase(),""),D=t=>{try{const e=W(t),n=s(t,8,!0),o=b(t,n-24);return{guid:e,size:n,data:o}}catch{return}},_=t=>{const e=s(t,2,!0),n=s(t,2,!0),o=s(t,2,!0),r=s(t,2,!0),c=s(t,2,!0);return{title:d(a(t,e,p)),artist:d(a(t,n,p)),copyright:d(a(t,o,p)),comment:d(a(t,r,p)),rating:d(a(t,c,p))}},I={"wm/albumtitle":"album"},$=t=>{const e={},n=s(t,2,!0);for(let o=0;o<n;o++){const r=s(t,2,!0),c=d(a(t,r,p)).toLowerCase(),l=c.startsWith("wm/")?c.slice(3):c,i=I[c]||c,f=s(t,2,!0),g=s(t,2,!0);switch(f){case 0:e[l]=e[i]=d(a(t,g,p));break;default:u(t,g)}}return e},q=t=>{var o;u(t,22);let e={},n;for(;n=D(t);){const r={GEACBF8C5AF5B48778467AA8C44FA4CCA:F,G941C23449894D149A1411D134E457054:F};e={...e,...(o=r[n.guid])==null?void 0:o.call(r,n.data)}}return e},F=t=>{const e={},n=s(t,2,!0);for(let o=0;o<n;o++){u(t,4);const r=s(t,2,!0),c=s(t,2,!0),l=s(t,2,!0),i=d(a(t,r,p)).toLowerCase(),f=i.startsWith("wm/")?i.slice(3):i,g=I[i]||i;switch(c){case 0:e[f]=e[g]=d(a(t,l,p));break;default:u(t,l)}}return e},J=t=>{var n;const e=y(t);try{const o=D(e);if(!o||o.guid!=="G3026B2758E66CF11A6D900AA0062CE6C")return;u(o.data,6);let r,c={};for(;r=D(o.data);){const l={G3326B2758E66CF11A6D900AA0062CE6C:_,G40A4D0D207E3D21197F000A0C95EA850:$,GB503BF5F2EA9CF118EE300C00C205365:q};c={...c,...(n=l[r.guid])==null?void 0:n.call(l,r.data)}}return c}catch{return}},P=t=>{try{const e=s(t,4),n=a(t,4,m).toLowerCase(),o=e===1?s(t,8):e||S(t);return{size:o,type:n,data:b(t,o-(e===1?16:8))}}catch{return}},U=function*(t){let e,n=0;for(;(e=P(t))&&!(n++>100);)yield e},Q={"\xA9alb":"album","\xA9wrt":"composer","\xA9nam":"title","\xA9art":"artist",aart:"albumartist","\xA9cmt":"comment",trkn:"track","\xA9too":"encoder","\xA9day":"year","\xA9gen":"genre",gnre:"genre"},Y=t=>{const e=[...U(t)].find(n=>n.type==="data");if(e){const n=e.data,o=s(n,4);u(n,4);const r={1:C,2:L,4:C,5:L}[o];return r&&a(n,S(n),r)}},Z=t=>{let e={};for(const{data:n,type:o}of U(t)){const r=Y(n);r&&(e={...e,[o]:r,[Q[o]||o]:r})}return e},A=t=>{var n;let e={};for(const{type:o,data:r}of U(t))e={...e,...(n=E[o])==null?void 0:n.call(E,r)};return e},E={moov:A,trak:A,mdia:A,udta:A,meta:t=>A(w(t)),ilst:Z},w=t=>{const e=T(a,4)(t,4,m),n=T(a,16)(t,4,m);return e==="hdlr"&&n==="mdta"||u(t,4),t},tt=t=>{const e=y(t),n=A(e);return Object.keys(n).length===0?void 0:n};exports.flac=K;exports.id3v1=O;exports.id3v2=X;exports.mp4=tt;exports.ogg=v;exports.wma=J;
