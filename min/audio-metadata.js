"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const d=t=>t.replace(/\0+$/,""),v=(t,e)=>{const n=t.indexOf(e);return[t.substring(0,n),t.substring(n+1)]},l=t=>{if(t instanceof Uint8Array&&(t=t.buffer.slice(0)),!(t instanceof ArrayBuffer))throw new Error("Expected instance of Buffer or ArrayBuffer");return new DataView(t)},T=(t,e,n)=>new Uint8Array(t.buffer).slice(e,e+n),h=t=>(e,n,r)=>new TextDecoder(t).decode(e.buffer.slice(n,n+r)),u=h("ascii"),b=h(),L=h("utf16be"),U=(t,e)=>{if(t.byteLength<e+27)return;const n=t.getUint8(e+26),r=T(t,e+27,n),i=27+n;if(!r.length)return;const c=i+r.reduce((a,s)=>a+s),o=i+7;return{pageSize:c,packet:l(T(t,e+o,c-o))}},p=t=>{try{const e=t.getUint32(0,!0),n=t.getUint32(4+e,!0),r={},i={tracknumber:"track"};for(let c=0,o=8+e;c<n;c++){const a=t.getUint32(o,!0),s=b(t,o+4,a),[g,m]=v(s,"="),f=g.toLowerCase();r[i[f]||f]=r[f]=d(m),o+=4+a}return r}catch{return}},k=t=>{const e=l(t),n=U(e,0);if(!n)return;const r=U(e,n.pageSize);if(r)return p(r.packet)},S=t=>u(t,t.byteLength-128,3)==="TAG",M=t=>{const e=l(t);try{if(!S(e))return;const n=e.byteLength-128,r=e.getUint8(n+125)===0,i=d(u(e,n+3,30)),c=d(u(e,n+33,30)),o=d(u(e,n+63,30)),a=d(u(e,n+93,4)),s=d(u(e,n+97,r?28:30)),g=r?e.getUint8(n+126):void 0,m=e.getUint8(n+127);return{title:i,artist:c,album:o,year:a,comment:s,track:g,genre:m}}catch{return}},y=(t,e)=>T(t,e,4).reduce((n,r)=>n<<7|r&268435455,0),w=t=>{switch(t){case 1:return(e,n,r)=>e.getUint16(n)===65279?L(e,n,r):h("utf16le")(e,n,r);case 2:return h("utf16be");case 3:return b;case 0:default:return u}},x={TALB:"album",TCOM:"composer",TIT1:"title",TIT2:"title",TPE1:"artist",TRCK:"track",TSSE:"encoder",TDRC:"year",TCON:"genre"},A=(t,e)=>{try{const n=u(t,e,4),r=10+y(t,e+4),i=n[0]==="T"?d(w(t.getUint8(e+9))(t,e+11,r-11)):void 0;return{id:n,size:r,content:i}}catch{return}},C=t=>{const e=l(t);if(u(e,0,3)!=="ID3")return;const n=e.getUint8(5),r=y(e,6),i=!!(n&128),c={},o=i?y(e,10):0;for(let a=10+o;a<10+o+r;){const s=A(e,a);if(!s)break;if(a+=s.size,!s.content)continue;const g=x[s.id]||s.id;if(g==="TXXX"){const[m,f]=v(s.content,"\0");c[m]=f}else c[g]=c[s.id]=s.content}return c},z=t=>u(t,0,4)==="fLaC",E=t=>{const e=l(t);if(!z(e))return;let n=4,r=!1,i={};for(;!r;){const c=e.getUint8(n),o=e.getUint16(n+1)*2**16+e.getUint8(n+3);r=c>127,(c&127)==4&&(i=Object.assign(i,p(l(T(e,n+4,o))))),n+=4+o}return i};exports.flac=E;exports.id3v1=M;exports.id3v2=C;exports.ogg=k;
